name: Keep Render Service Alive

on:
  schedule:
    # Runs every 5 minutes to keep Render awake (free tier sleeps after 15 min)
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allows manual trigger from GitHub UI

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render service - Main page
        run: |
          echo "ğŸ”” Pinging main page at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" https://news-insight-parser.onrender.com/)
          echo "Response code: $response"

          if [ $response -eq 200 ] || [ $response -eq 302 ]; then
            echo "âœ… Main page responding"
          else
            echo "âš ï¸ Main page returned: $response"
          fi

      - name: Ping Render service - API status
        run: |
          echo "ğŸ”” Pinging API status at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" https://news-insight-parser.onrender.com/api/status)
          echo "Response code: $response"

          if [ $response -eq 200 ]; then
            echo "âœ… API status responding"
          else
            echo "âš ï¸ API status returned: $response"
          fi

      - name: Ping Render service - Health check
        run: |
          echo "ğŸ”” Pinging scheduler status at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" https://news-insight-parser.onrender.com/api/scheduler/status)
          echo "Response code: $response"

          if [ $response -eq 200 ]; then
            echo "âœ… Scheduler status responding"
          else
            echo "âš ï¸ Scheduler status returned: $response"
          fi

      - name: Keep-alive timestamp
        run: echo "âœ… Keep-alive completed - $(date -u)"
