{% extends "base.html" %}

{% block title %}–ü–æ—Å—Ç—ã - News Insight Parser{% endblock %}

{% block content %}
<div class="posts-page">
    <div class="page-header">
        <h2>
            {% if source %}
                {% if source == 'hacker_news' %}
                    Hacker News
                {% elif source == 'reddit' %}
                    Reddit
                {% elif source == 'product_hunt' %}
                    Product Hunt
                {% elif source == 'devto' %}
                    Dev.to
                {% elif source == 'vc_blogs' %}
                    VC Blogs
                {% elif source == 'techcrunch' %}
                    TechCrunch
                {% endif %}
            {% else %}
                –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            {% endif %}
        </h2>

        <!-- Search Bar -->
        <div class="search-section" style="margin-bottom: 20px;">
            <form method="GET" action="/posts" style="display: flex; gap: 10px; align-items: center;">
                <input type="text"
                       name="q"
                       value="{{ search_query or '' }}"
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É..."
                       style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                {% if source %}
                <input type="hidden" name="source" value="{{ source }}">
                {% endif %}
                <button type="submit" class="btn btn-primary">–ò—Å–∫–∞—Ç—å</button>
                {% if search_query %}
                <a href="/posts{% if source %}?source={{ source }}{% endif %}" class="btn" style="background: #95a5a6; color: white;">–°–±—Ä–æ—Å–∏—Ç—å</a>
                {% endif %}
            </form>
            {% if search_query %}
            <p style="margin-top: 10px; color: #7f8c8d; font-size: 14px;">
                –ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {{ posts|length }} –ø–æ –∑–∞–ø—Ä–æ—Å—É "<strong>{{ search_query }}</strong>"
            </p>
            {% endif %}
        </div>

        <!-- Source Filter -->
        <div class="filter-section">
            <div class="filter-buttons">
                <a href="/posts{% if search_query %}?q={{ search_query }}{% endif %}" class="btn {% if not source %}btn-active{% endif %}">–í—Å–µ</a>
                <a href="/posts?source=hacker_news{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'hacker_news' %}btn-active{% endif %}">Hacker News</a>
                <a href="/posts?source=reddit{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'reddit' %}btn-active{% endif %}">Reddit</a>
                <a href="/posts?source=product_hunt{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'product_hunt' %}btn-active{% endif %}">Product Hunt</a>
                <a href="/posts?source=devto{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'devto' %}btn-active{% endif %}">Dev.to</a>
                <a href="/posts?source=vc_blogs{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'vc_blogs' %}btn-active{% endif %}">VC Blogs</a>
                <a href="/posts?source=techcrunch{% if search_query %}&q={{ search_query }}{% endif %}" class="btn {% if source == 'techcrunch' %}btn-active{% endif %}">TechCrunch</a>
            </div>
        </div>
    </div>

    <!-- Posts List -->
    {% if posts %}
    <div class="posts-list">
        {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <span class="badge" style="background: #3498db; color: white;">
                    {% if post.source == 'hacker_news' %}HN
                    {% elif post.source == 'reddit' %}Reddit
                    {% elif post.source == 'product_hunt' %}PH
                    {% elif post.source == 'devto' %}Dev.to
                    {% elif post.source == 'vc_blogs' %}VC
                    {% elif post.source == 'techcrunch' %}TC
                    {% endif %}
                </span>
                <span class="post-score">{{ post.score }} points</span>
                {% if post.importance_score > 50 %}
                <span class="badge" style="background: #f39c12; color: white;">
                    ‚≠ê {{ post.importance_score|int }}/100
                </span>
                {% endif %}
                <span class="post-time">{{ time_ago(post.created_at) }}</span>
            </div>

            <h3 class="post-title">
                <a href="/post/{{ post.id }}" class="post-link">
                    {{ post.title }}
                </a>
            </h3>
            {% if post.source_url %}
            <div style="margin-top: 8px;">
                <a href="{{ post.source_url }}" target="_blank" style="color: #3498db; font-size: 14px; text-decoration: none;">
                    üîó –û—Ç–∫—Ä—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª ‚Üí
                </a>
            </div>
            {% endif %}

            {% if post.content %}
            <div class="post-text">
                {{ truncate_text(clean_html(post.content), 300) }}
            </div>
            {% endif %}

            <div class="post-meta">
                <span>by {{ post.author }}</span>
                <span>{{ post.comments_count }} comments</span>
                {% if post.duplicate_group_id %}
                <span style="color: #e74c3c;">üîó –î—É–±–ª–∏–∫–∞—Ç</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state card">
        <p>–ü–æ—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.</p>
        <a href="/" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
    </div>
    {% endif %}
</div>

<style>
.post-link {
    color: #2c3e50;
    text-decoration: none;
    transition: color 0.2s ease;
}

.post-link:hover {
    color: #3498db;
    text-decoration: underline;
}
</style>
{% endblock %}
